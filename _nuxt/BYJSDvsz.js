import{aw as m,a4 as E,be as _,as as h,r as z,aH as A,M as B}from"./DWFz8vzl.js";function b(o,u,l){let c;E(l)?c={evaluating:l}:c={};const{lazy:r=!1,evaluating:s=void 0,shallow:f=!0,onError:n=_}=c,e=h(!r),t=f?h(u):z(u);let a=0;return A(async g=>{if(!e.value)return;a++;const d=a;let p=!1;s&&Promise.resolve().then(()=>{s.value=!0});try{const v=await o(w=>{g(()=>{s&&(s.value=!1),p||w()})});d===a&&(t.value=v)}catch(v){n(v)}finally{s&&d===a&&(s.value=!1),p=!0}}),r?B(()=>(e.value=!0,t.value)):t}const i=new Map;function x(o){const u=m();function l(n){var e;const t=i.get(o)||new Set;t.add(n),i.set(o,t);const a=()=>r(n);return(e=u==null?void 0:u.cleanups)==null||e.push(a),a}function c(n){function e(...t){r(e),n(...t)}return l(e)}function r(n){const e=i.get(o);e&&(e.delete(n),e.size||s())}function s(){i.delete(o)}function f(n,e){var t;(t=i.get(o))==null||t.forEach(a=>a(n,e))}return{on:l,once:c,off:r,emit:f,reset:s}}export{b as c,x as u};
